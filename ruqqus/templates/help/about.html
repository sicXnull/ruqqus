<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="author" content="">

  {% block title %}
  <title>About - Ruqqus</title>
  <meta name="description" content="The independent social platform">
  {% endblock %}

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600&display=swap" rel="stylesheet">

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- Ruqqus CSS -->
  <link rel="stylesheet" href="/assets/style/main.css">

  <!-- Font Awesome -->
  <link href="/assets/fontawesome/css/all.css" rel="stylesheet"> <!--load all styles -->

  <!-- Code Prettify -->

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

</head>

<body id="page">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-md navbar-light bg-white border-bottom fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">ruqqus</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"><i class="fal fa-bars text-dark" style="font-size: 2rem;"></i></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.twitter.com/ruqqus">Twitter</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Hero -->

<section class="py-7 py-md-8">
    <div class="container">
        <div class="row text-dark text-dark text-md-left align-items-center">
            <div class="col-12 col-md-5 col-lg-6">
                <h1>The social platform for uncensored discourse</h1>
                <p class="opacity-80 mb-6">Share and discover content from around the web in one
                    place.
                    Vote on what
                    you like or dislike, and engage in uncensored discussion with the community.
                </p>
                <div>
                    <a href="/signup" class="btn btn-lg btn-primary">Create account</a>
                </div>
            </div>
            <div class="col-12 col-md-5 col-lg-6 text-right">
                <img src="/assets/images/illustrations/post.svg" class="img-fluid shadow rounded mb-3 mt-6 mt-md-0" data-aos="zoom-out">
                <img src="/assets/images/illustrations/reply_upvoted_1.svg" class="img-fluid shadow rounded mb-3" data-aos-easing="ease-in-out"
                data-aos="fade-up" data-aos-delay="500">
                <img src="/assets/images/illustrations/reply_downvoted_1.svg" class="img-fluid shadow rounded mb-3" data-aos-easing="ease-in-out"
                data-aos="fade-up" data-aos-delay="1000">
                <img src="/assets/images/illustrations/reply_neutral_1.svg" class="img-fluid shadow rounded mb-3" data-aos-easing="ease-in-out"
                data-aos="fade-up" data-aos-delay="1500">
            </div>
        </div>
    </div>
</section>

    <!-- Features

    <section class="py-7 py-md-8">
        <div class="container">
            <div class="row justify-content-center text-center text-dark">

                <div class="col">

                    <h2 class="mb-6 mb-md-7">
                        Share, vote, and discuss on the web without censorship.
                    </h2>

                </div>

            </div>

    </section>

-->

<!-- Why Choose Ruqqus -->

<section class="py-7 py-md-8 bg-light">
    <div class="container">
        <div class="row justify-content-center text-center text-dark">

            <div class="col">

                <h2 class="mb-6 mb-md-7">
                    Publish, vote, and discuss. All without censorship.
                </h2>

            </div>

        </div>
        <div class="row justify-content-around">
            <div class="col-10 col-md-3" data-aos="fade-up">

                <i class="fad fa-code text-primary mb-3" style="font-size: 2.25rem;"></i>

                <h3 class="h5 mb-3">
                    Independent
                </h3>

                <p class="text-dark mb-6 mb-md-0">
                    We're not owned by big tech. We're a handful of individuals from different backgrounds working
                    together to foster free speech social media.
                </p>

            </div>
            <div class="col-10 col-md-3" data-aos="fade-up" data-aos-delay="100">

                <i class="fad fa-podium-star text-primary mb-3" style="font-size: 2.25rem;"></i>

                <h3 class="h5 mb-3">
                    Free speech
                </h3>

                <p class="text-dark mb-6 mb-md-0">
                    We don't believe in censoring. You're free to say and discuss anything that would be protected by the First Amendment in the public square.
                </p>

            </div>
            <div class="col-10 col-md-3" data-aos="fade-up" data-aos-delay="100">

                <i class="fad fa-user-secret text-primary mb-3" style="font-size: 2.25rem;"></i>

                <h3 class="h5 mb-3">
                    Privacy-focused
                </h3>

                <p class="text-dark mb-md-0">
                    The Ruqqus team will not share or sell your data to outside parties. We do not allow
                    advertisements that track you either.
                </p>

            </div>
        </div>
    </div>
</section>

<!-- Open Source Explainer -->

<section class="py-7 py-md-8">

    <div class="container">

        <div class="row justify-content-between align-items-center text-center text-md-left text-dark">

            <div class="col-12 col-md-6">

                <ul class="list-inline no-bullets display-5 mb-3" style="opacity: .1">
                    <li class="list-inline-item mr-3">
                        <i class="fab fa-python"></i>
                    </li>
                    <li class="list-inline-item mr-3">
                        <i class="fab fa-sass"></i>
                    </li>
                    <li class="list-inline-item mr-3">
                        <i class="fab fa-js"></i>
                    </li>
                </ul>

                <h2>
                    Did we mention open-source?
                </h2>

                <p class="text-muted mb-6 mb-md-5">We like to keep things transparent. For this reason, our entire
                    codebase is open-source and
                    available on Github. View our
                    algorithms right from your browser. No biased trending or sorting manipulation on Ruqqus.
                </p>

                <a href="https://github.com/ruqqus/ruqqus" class="btn btn-lg btn-primary d-none d-md-inline-block">View our code</a>

            </div>

            <div class="col-12 col-md-6 d-none d-md-block">

                <div class="row no-gutters mb-3" style="border-bottom: 2px solid #E0E4E9;">

                    <div class="col">

                        <div class="nav nav-pills justify-content-between" id="v-pills-tab" role="tablist"
                        aria-orientation="vertical" style="top: 2px; position: relative;">
                        <a class="nav-link text-center show active" id="v-pills-voting-tab" data-toggle="pill"
                        href="#v-pills-voting" role="tab" aria-controls="v-pills-voting"
                        aria-selected="false"><i class="far fa-arrow-alt-circle-up mr-2"
                        aria-hidden="true"></i>Voting</a>
                        <a class="nav-link text-center" id="v-pills-submission-tab" data-toggle="pill"
                        href="#v-pills-submission" role="tab" aria-controls="v-pills-submission"
                        aria-selected="false"><i class="far fa-feather-alt mr-2" aria-hidden="true"></i>Post</a>
                        <a class="nav-link text-center" id="v-pills-user-tab" data-toggle="pill"
                        href="#v-pills-user" role="tab" aria-controls="v-pills-user"
                        aria-selected="false"><i class="far fa-user-circle mr-2"
                        aria-hidden="true"></i>User</a>
                        <a class="nav-link text-center d-none d-lg-block" id="v-pills-comment-tab"
                        data-toggle="pill" href="#v-pills-comment" role="tab"
                        aria-controls="v-pills-comment" aria-selected="true"><i
                        class="far fa-comment-dots mr-2" aria-hidden="true"></i>Comment</a>
                    </div>

                </div>

            </div>

            <div class="row">

                <div class="col-auto">

                    <div class="tab-content text-left bg-dark" id="v-pills-tabContent">

                        <div class="tab-pane fade show active" id="v-pills-voting" role="tabpanel"
                        aria-labelledby="v-pills-voting-tab">
                        <pre class="prettyprint lang-python linenums bg-dark border-0 px-3"
                        style="height: 330px; overflow-x: hidden;">
    import time
    from ruqqus.helpers.wrappers
    import *
    from flask
    import *

    from ruqqus.__main__
    import app, db, cache
    from ruqqus.classes
    import *

    @cache.memoize(timeout = 30)
    def frontlist(sort = "hot", page = 1):

    cutoff = int(time.time()) - (60 * 60 * 24 * 30)

    posts = db.query(Submission).filter(Submission.created_utc >= cutoff,
    Submission.is_banned == False,
    Submission.stickied == False)

    if sort == "hot":
    posts = posts.order_by(text("submissions.rank_hot desc"))
    elif sort == "new":
    posts = posts.order_by(Submission.created_utc.desc())
    elif sort == "fiery":
    posts = posts.order_by(text("submissions.rank_fiery desc"))
    elif sort == "top":
    posts = posts.order_by(text("submissions.score desc"))

    posts = [x.id
    for x in posts.offset(25 * (page - 1)).limit(25).all()
    ]

    return posts

    @app.route("/", methods = ["GET"])
    @auth_desired
    def home(v):

    page = int(request.args.get("page", 1))

    sort_method = request.args.get("sort", "hot")

    # get list of ids
    ids = frontlist(sort = sort_method, page = page)

    # assemble list of tuples
    i = 1
    tups = []
    for x in ids:
    tups.append((x, i))
    i += 1

    # tuple string
    tups = str(tups).lstrip("[").rstrip("]")

    # hit db
    for entries
    posts = db.query(Submission).from_statement(
    text(f ""
    "
    select submissions.*, submissions.ups, submissions.downs from submissions join(values {
    tups
}) as x(id, n) on submissions.id = x.id order by x.n ""
"
)).all()

# If page 1, check
for sticky
if page == 1:
sticky = []
sticky = db.query(Submission).filter_by(stickied = True).first()
if sticky:
posts = [sticky] + posts

return render_template("home.html", v = v, listing = posts, sort_method = sort_method)
                </pre>
            </div>

            <div class="tab-pane fade" id="v-pills-submission" role="tabpanel"
            aria-labelledby="v-pills-submission-tab">
            <pre class="prettyprint lang-python linenums bg-dark border-0 px-3"
            style="height: 330px; overflow-x: hidden;">
from flask import render_template, request
import time
from sqlalchemy import *
from sqlalchemy.orm import relationship
import math
from urllib.parse import urlparse
from random import randint

from ruqqus.helpers.base36 import *
from ruqqus.helpers.lazy import lazy
from ruqqus.__main__ import Base, db, cache
from .user import User
from .votes import Vote

class Submission(Base):

__tablename__="submissions"

id = Column(BigInteger, primary_key=True)
author_id = Column(BigInteger, ForeignKey(User.id))
title = Column(String(500), default=None)
url = Column(String(500), default=None)
created_utc = Column(BigInteger, default=0)
is_banned = Column(Boolean, default=False)
distinguish_level=Column(Integer, default=0)
created_str=Column(String(255), default=None)
stickied=Column(Boolean, default=False)
comments=relationship("Comment", lazy="dynamic", backref="submissions")
body=Column(String(2000), default="")
body_html=Column(String(2200), default="")

#These are virtual properties handled as postgres functions server-side
#There is no difference to SQLAlchemy, but they cannot be written to
#appts = db.session.query(Appointment).from_statement(func.getopenappointments(current_user.id))
ups = Column(Integer, server_default=FetchedValue())
downs=Column(Integer, server_default=FetchedValue())
age=Column(Integer, server_default=FetchedValue())
comment_count=Column(Integer, server_default=FetchedValue())


def __init__(self, *args, **kwargs):

if "created_utc" not in kwargs:
kwargs["created_utc"]=int(time.time())
kwargs["created_str"]=time.strftime("%I:%M %p on %d %b %Y", time.gmtime(kwargs["created_utc"]))


super().__init__(*args, **kwargs)

def __repr__(self):
return f"<Submission(id={self.id})>"

@property
@cache.memoize(timeout=60)
def rank_hot(self):
return (self.ups-self.down)/(((self.age+100000)/6)**(1/3))

@property
@cache.memoize(timeout=60)
def rank_fiery(self):
return (math.sqrt(self.ups * self.downs))/(((self.age+100000)/6)**(1/3))

@property
@cache.memoize(timeout=60)
def score(self):
return self.ups-self.downs

@property
def base36id(self):
return base36encode(self.id)

@property
def fullname(self):
return f"t2_{self.base36id}"

@property
def permalink(self):
return f"/post/{self.base36id}"

def rendered_page(self, comment=None, v=None):

#check for banned
if self.is_banned:
if v:
if v.admin_level:
template="submission.html"

else: 
template="submission_banned.html"
else:
template="submission_banned.html"
else:
template="submission.html"

#load and tree comments
#calling this function with a comment object will do a comment permalink thing
self.tree_comments(comment=comment)

#return template
return render_template(template, v=v, p=self, sort_method=request.args.get("sort","Hot").capitalize())

@property
@lazy
def author(self):
if self.author_id==0:
return None
else:
return db.query(User).filter_by(id=self.author_id).first()

@property
def domain(self):
return urlparse(self.url).netloc

@property
def score_fuzzed(self, k=0.01):
real=self.score
a=math.floor(real*(1-k))
b=math.ceil(real*(1+k))
return randint(a,b)        

def tree_comments(self, comment=None):

def tree_replies(thing, layer=1):

thing.__dict__["replies"]=[]
i=len(comments)-1

while i>=0:
if comments[i].parent_fullname==thing.fullname:
thing.__dict__["replies"].append(comments[i])
comments.pop(i)

i-=1

if layer <=8:
for reply in thing.replies:
tree_replies(reply, layer=layer+1)

######

if comment:
self.replies=[comment]
return



#get sort type
sort_type = request.args.get("sort","hot")


#Treeing is done from the end because reasons, so these sort orders are reversed
if sort_type=="hot":
comments=self.comments.order_by(text("comments.rank_hot ASC")).all()
elif sort_type=="top":
comments=self.comments.order_by(text("comments.score ASC")).all()
elif sort_type=="new":
comments=self.comments.order_by(text("comments.created_utc")).all()
elif sort_type=="fiery":
comments=self.comments.order_by(text("comments.rank_fiery ASC")).all()



tree_replies(self)




@property
def age_string(self):

age=self.age

if age<60:
return "just now"
elif age<3600:
minutes=int(age/60)
return f"{minutes} minute{'s' if minutes>1 else ''} ago"
elif age<86400:
hours=int(age/3600)
return f"{hours} hour{'s' if hours>1 else ''} ago"
elif age<2592000:
days=int(age/86400)
return f"{days} day{'s' if days>1 else ''} ago"

now=time.gmtime()
ctd=time.gmtime(self.created_utc)
months=now.tm_mon-ctd.tm_mon+12*(now.tm_year-ctd.tm_year)

if months < 12:
return f"{months} month{'s' if months>1 else ''} ago"
else:
years=now.tm_year-ctd.tm_year
return f"{years} year{'s' if years>1 else ''} ago"


@property
@lazy
def created_date(self):

return time.strftime("%d %B %Y", time.gmtime(self.created_utc))
    </pre>
</div>

<div class="tab-pane fade" id="v-pills-user" role="tabpanel"
aria-labelledby="v-pills-user-tab">
<pre class="prettyprint lang-python linenums bg-dark border-0 px-3"
style="height: 330px; overflow-x: hidden;">
from werkzeug.security import generate_password_hash, check_password_hash
from flask import render_template, session, request
from time import strftime, time, gmtime
from sqlalchemy import *
from sqlalchemy.orm import relationship, deferred
from os import environ
from secrets import token_hex
import random

from ruqqus.helpers.base36 import *
from ruqqus.helpers.security import *
from ruqqus.helpers.lazy import lazy
from .votes import Vote
from .ips import IP
from ruqqus.__main__ import Base, db, cache

class User(Base):

__tablename__="users"
id = Column(Integer, primary_key=True)
username = Column(String, default=None)
email = Column(String, default=None)
passhash = Column(String, default=None)
created_utc = Column(BigInteger, default=0)
admin_level = Column(Integer, default=0)
is_banned = Column(Boolean, default=False)
is_activated = Column(Boolean, default=False)
reddit_username = Column(String, default=None)
over_18=Column(Boolean, default=False)
creation_ip=Column(String, default=None)
most_recent_ip=Column(String, default=None)
submissions=relationship("Submission", lazy="dynamic", backref="users")
comments=relationship("Comment", lazy="dynamic", primaryjoin="Comment.author_id==User.id")
comment_notifications=relationship("Comment", lazy="dynamic", primaryjoin="Comment.parent_author_id==User.id")
votes=relationship("Vote", lazy="dynamic", backref="users")
commentvotes=relationship("CommentVote", lazy="dynamic", backref="users")
ips = relationship('IP', lazy="dynamic", backref="users")

#properties defined as SQL server-side functions
energy = deferred(Column(Integer, server_default=FetchedValue()))

def __init__(self, **kwargs):

if "password" in kwargs:

kwargs["passhash"]=self.hash_password(kwargs["password"])
kwargs.pop("password")

kwargs["created_utc"]=int(time())

super().__init__(**kwargs)

@property
@cache.memoize(timeout=60)
def karma(self):
return self.energy


@property
def base36id(self):
return base36encode(self.id)

@property
def fullname(self):
return f"t1_{self.base36id}"

def vote_status_on_post(self, post):

vote = self.votes.filter_by(submission_id=post.id).first()
if not vote:
return 0

return vote.vote_type


def vote_status_on_comment(self, comment):

vote = self.commentvotes.filter_by(comment_id=comment.id).first()
if not vote:
return 0

return vote.vote_type

def update_ip(self, remote_addr):

if not remote_addr==self.most_recent_ip:
self.most_recent_ip = remote_addr
db.add(self)

existing=self.ips.filter_by(ip=remote_addr).first()

if existing:
existing.created_utc=time()
db.add(existing)

else:
db.add(IP(user_id=self.id, ip=remote_addr))

db.commit()

def hash_password(self, password):
return generate_password_hash(password, method='pbkdf2:sha512', salt_length=8)

def verifyPass(self, password):
return check_password_hash(self.passhash, password)

def rendered_userpage(self, v=None):

if self.is_banned:
return render_template("userpage_banned.html", u=self, v=v)

page=int(request.args.get("page","1"))

if v:
if v.admin_level or v.id==self.id:
listing=[p for p in self.submissions.order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]
else:
listing=[p for p in self.submissions.filter_by(is_banned=False).order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]
else:
listing=[p for p in self.submissions.filter_by(is_banned=False).order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]  

return render_template("userpage.html", u=self, v=v, listing=listing)

def rendered_comments_page(self, v=None):

if self.is_banned:
return render_template("userpage_banned.html", u=self, v=v)

page=int(request.args.get("page","1"))

if v:
if v.admin_level or v.id==self.id:
listing=[p for p in self.comments.order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]
else:
listing=[p for p in self.comments.filter_by(is_banned=False).order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]
else:
listing=[p for p in self.comments.filter_by(is_banned=False).order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]

return render_template("userpage_comments.html", u=self, v=v, listing=listing)

@property
def formkey(self):

if "session_id" not in session:
session["session_id"]=token_hex(16)

msg=f"{session['session_id']}{self.id}"

return generate_hash(msg)

def validate_formkey(self, formkey):

return validate_hash(f"{session['session_id']}{self.id}", formkey)

def verify_username(self, username):

#no reassignments allowed
if self.username_verified:
return render_template("settings.html", v=self, error="Your account has already validated its username.")

#For use when verifying username with reddit
#Set username. Randomize username of any other existing account with same
try:
existing = db.query(User).filter_by(username=username).all()[0]

#No reassignments allowed
if existing.username_verified:
return render_template("settings.html", v=self, error="Another account has already validated that username.")

# Rename new account to user_id
# guaranteed to be unique
existing.username=f"user_{existing.id}"

db.add(existing)
db.commit()

except IndexError:
pass

self.username=username
self.username_verified=True

db.add(self)
db.commit()

return render_template("settings.html", v=self, msg="Your account name has been updated and validated.")

@property
def url(self):
return f"/u/{self.username}"

@property
def permalink(self):
return self.url

@property
@lazy
def created_date(self):

return strftime("%d %B %Y", gmtime(self.created_utc))

def __repr__(self):
return f"<User(username={self.username})>"


@property
@lazy
def color(self):

random.seed(self.id)

R=random.randint(16, 239)
G=random.randint(16, 239)
B=random.randint(16, 239)


return str(base_encode(R, 16))+str(base_encode(G, 16))+str(base_encode(B, 16))

def notifications_unread(self, page=1, include_read=False):

page=int(page)

if include_read:
notifications=[c for c in self.comment_notifications.order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]
else:
notifications=[c for c in self.comment_notifications.filter_by(read=False).order_by(text("created_utc desc")).offset(25*(page-1)).limit(25)]


for c in notifications:
if not c.read:
c.read=True
db.add(c)

db.commit()

return render_template("notifications.html", v=self, notifications=notifications)

@property
def notifications_count(self):

return self.comment_notifications.filter_by(read=False, is_banned=False).count()

@property
def post_count(self):

return self.submissions.filter_by(is_banned=False).count()

</pre>
</div>

<div class="tab-pane fade" id="v-pills-comment" role="tabpanel"
aria-labelledby="v-pills-comment-tab">
<pre class="prettyprint lang-python linenums bg-dark border-0 px-3"
style="height: 330px; overflow-x: hidden;">
from flask import render_template
import time
from sqlalchemy import *
from sqlalchemy.orm import relationship, deferred
from random import randint
import math

from ruqqus.helpers.base36 import *
from ruqqus.helpers.lazy import lazy
from ruqqus.__main__ import Base, db, cache
from .user import User
from .submission import Submission
from .votes import CommentVote

class Comment(Base):

__tablename__="comments"

id = Column(BigInteger, primary_key=True)
author_id = Column(BigInteger, ForeignKey(User.id))
body = Column(String(2000), default=None)
parent_submission = Column(BigInteger, ForeignKey(Submission.id))
parent_fullname = Column(BigInteger) #this column is foreignkeyed to comment(id) but we can't do that yet as "comment" class isn't yet defined
created_utc = Column(BigInteger, default=0)
is_banned = Column(Boolean, default=False)
body_html = Column(String)
distinguish_level=Column(Integer, default=0)
parent_author_id=Column(Integer, ForeignKey(User.id))
read=Column(Boolean, default=False)

#These are virtual properties handled as postgres functions server-side
#There is no difference to SQLAlchemy, but they cannot be written to
ups = Column(Integer, server_default=FetchedValue())
downs=Column(Integer, server_default=FetchedValue())
age=Column(Integer, server_default=FetchedValue())

def __init__(self, *args, **kwargs):


if "created_utc" not in kwargs:
kwargs["created_utc"]=int(time.time())

for x in kwargs:
if x not in ["ups","downs","score","rank_hot","rank_fiery","age","comment_count"]:
self.__dict__[x]=kwargs[x]

def __repr__(self):
return f"<Comment(id={self.id})"


@property
@cache.memoize(timeout=60)
def rank_hot(self):
return (self.ups-self.down)/(((self.age+100000)/6)**(1/3))

@property
@cache.memoize(timeout=60)
def rank_fiery(self):
return (math.sqrt(self.ups * self.downs))/(((self.age+100000)/6)**(1/3))

@property
@cache.memoize(timeout=60)
def score(self):
return self.ups-self.downs


@property
def base36id(self):
return base36encode(self.id)

@property
def fullname(self):
return f"t3_{self.base36id}"

@property
def is_top_level(self):
return self.parent_fullname.startswith("t2_")

@property
@lazy
def author(self):
return db.query(User).filter_by(id=self.author_id).first()

@property
@lazy
def post(self):

return db.query(Submission).filter_by(id=self.parent_submission).first()

@property
@lazy
def parent(self):

if self.is_top_level:
return db.query(Submission).filter_by(id=self.parent_submission).first()
else:
return db.query(Comment).filter_by(id=base36decode(self.parent_fullname.split(sep="_")[1])).first()

@property
def children(self):

return db.query(Comment).filter_by(parent_comment=self.id).all()

@property
def replies(self):

if "replies" in self.__dict__:
return self.__dict__["replies"]
else:
return db.query(Comment).filter_by(parent_fullname=self.fullname).all()

@property
@lazy
def permalink(self):

return f"/post/{self.post.base36id}/comment/{self.base36id}"

@property
@cache.memoize(timeout=60)
def any_descendants_live(self):

if self.replies==[]:
return False

if any([not x.is_banned for x in self.replies]):
return True

else:
return any([x.any_descendants_live for x in self.replies])


def rendered_comment(self, v=None, render_replies=True, standalone=False, level=1):

if self.is_banned:
if v:
if v.admin_level>1:
return render_template("single_comment.html", v=v, c=self, replies=self.replies)

if self.any_descendants_live:
return render_template("single_comment_banned.html", c=self, replies=self.replies)
else:
return ""

return render_template("single_comment.html", v=v, c=self, replies=self.replies, render_replies=render_replies, standalone=standalone, level=level)

@property
@cache.memoize(timeout=60)
def score_fuzzed(self, k=0.01):
real=self.score
a=math.floor(real*(1-k))
b=math.ceil(real*(1+k))
return randint(a,b)

@property
@lazy
def age_string(self):

age=self.age

if age<60:
return "just now"
elif age<3600:
minutes=int(age/60)
return f"{minutes} minute{'s' if minutes>1 else ''} ago"
elif age<86400:
hours=int(age/3600)
return f"{hours} hour{'s' if hours>1 else ''} ago"
elif age<2592000:
days=int(age/86400)
return f"{days} day{'s' if days>1 else ''} ago"

now=time.gmtime()
ctd=time.gmtime(self.created_utc)
months=now.tm_mon-ctd.tm_mon+12*(now.tm_year-ctd.tm_year)

if months < 12:
return f"{months} month{'s' if months>1 else ''} ago"
else:
years=now.tm_year-ctd.tm_year
return f"{years} year{'s' if years>1 else ''} ago"
</pre>
</div>

</div>

</div>

</div>

</div>

</div>

<div class="row text-left text-white d-flex d-md-none">

    <div class="col-auto">

        <a href="#" class="btn btn-lg btn-primary btn-block mb-6">View our code</a>

        <pre class="prettyprint lang-python linenums bg-dark border-0 px-3"
        style="height: 330px; overflow-x: hidden;">
import time
from ruqqus.helpers.wrappers
import *
from flask
import *

from ruqqus.__main__
import app, db, cache
from ruqqus.classes
import *

@cache.memoize(timeout = 30)
def frontlist(sort = "hot", page = 1):

cutoff = int(time.time()) - (60 * 60 * 24 * 30)

posts = db.query(Submission).filter(Submission.created_utc >= cutoff,
Submission.is_banned == False,
Submission.stickied == False)

if sort == "hot":
posts = posts.order_by(text("submissions.rank_hot desc"))
elif sort == "new":
posts = posts.order_by(Submission.created_utc.desc())
elif sort == "fiery":
posts = posts.order_by(text("submissions.rank_fiery desc"))
elif sort == "top":
posts = posts.order_by(text("submissions.score desc"))

posts = [x.id
for x in posts.offset(25 * (page - 1)).limit(25).all()
]

return posts

@app.route("/", methods = ["GET"])
@auth_desired
def home(v):

page = int(request.args.get("page", 1))

sort_method = request.args.get("sort", "hot")

# get list of ids
ids = frontlist(sort = sort_method, page = page)

# assemble list of tuples
i = 1
tups = []
for x in ids:
tups.append((x, i))
i += 1

# tuple string
tups = str(tups).lstrip("[").rstrip("]")

# hit db
for entries
posts = db.query(Submission).from_statement(
text(f ""
"
select submissions.*, submissions.ups, submissions.downs from submissions join(values {
tups
}) as x(id, n) on submissions.id = x.id order by x.n ""
"
)).all()

# If page 1, check
for sticky
if page == 1:
sticky = []
sticky = db.query(Submission).filter_by(stickied = True).first()
if sticky:
posts = [sticky] + posts

return render_template("home.html", v = v, listing = posts, sort_method = sort_method)
</pre>

</div>

</div>

</div>

</section>

<!-- CTA -->

<section class="py-7 py-md-8 bg-light">

    <div class="container">

        <div class="row justify-content-around align-items-center mb-5">

            <div class="col col-md-6">

                <h2 class="text-center text-dark">Make a Ruqqus today.</h2>
                <p class="text-center text-dark mb-6 mb-md-0">Sign up and become part of the community
                    in less than 17.76 seconds.
                </p>

            </div>

        </div>

        <div class="row justify-content-around align-items-center text-center">

            <div class="col col-md-6">

                <a href="/signup" class="btn btn-primary btn-lg">Join Ruqqus</a>

            </div>

        </div>

    </div>

</section>

{% include "footer_article.html" %}

{% include "bootstrap.html" %}

<!-- Initialize BS 4 tool tips -->

<script src="/assets/js/tooltips.js"></script>

<!-- BS Spinner JS -->

<script src="/assets/js/spinner.js"></script>

<!-- AOS Animate -->

<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script>
    AOS.init();

        // You can also pass an optional settings object
        // below listed default settings
        AOS.init({

            once: true // whether animation should happen only once - while scrolling down

        });
</script>

</body>

</html>